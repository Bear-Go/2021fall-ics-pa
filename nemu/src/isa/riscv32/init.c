#include <isa.h>
#include <memory/paddr.h>

// this is not consistent with uint8_t
// but it is ok since we do not access the array directly
static const uint32_t img [] = {
0x00000413,//,//,//,//,//,//,//,//,//,//,//li,//s0,0
0x00009117,//,//,//,//,//,//,//,//,//,//,//auipc,//sp,0x9
0xffc10113,//,//,//,//,//,//,//,//,//,//,//addi,//sp,sp,-4,//#,//80009000,//<_end>
0x14c000ef,//,//,//,//,//,//,//,//,//,//,//jal,//ra,80000158,//<_trm_init>

0x00050463,//,//,//,//,//,//,//,//,//,//,//beqz,//a0,80000018,//<check+0x8>
0x00008067,//,//,//,//,//,//,//,//,//,//,//ret
0xff010113,//,//,//,//,//,//,//,//,//,//,//addi,//sp,sp,-16
0x00100513,//,//,//,//,//,//,//,//,//,//,//li,//a0,1
0x00112623,//,//,//,//,//,//,//,//,//,//,//sw,//ra,12(sp)
0x128000ef,//,//,//,//,//,//,//,//,//,//,//jal,//ra,8000014c,//<halt>

0xfc010113,//,//,//,//,//,//,//,//,//,//,//addi,//sp,sp,-64
0x02912a23,//,//,//,//,//,//,//,//,//,//,//sw,//s1,52(sp)
0x01712e23,//,//,//,//,//,//,//,//,//,//,//sw,//s7,28(sp)
0x01812c23,//,//,//,//,//,//,//,//,//,//,//sw,//s8,24(sp)
0x80000bb7,//,//,//,//,//,//,//,//,//,//,//lui,//s7,0x80000
0x80000c37,//,//,//,//,//,//,//,//,//,//,//lui,//s8,0x80000
0x800004b7,//,//,//,//,//,//,//,//,//,//,//lui,//s1,0x80000
0x03312623,//,//,//,//,//,//,//,//,//,//,//sw,//s3,44(sp)
0x03512223,//,//,//,//,//,//,//,//,//,//,//sw,//s5,36(sp)
0x03612023,//,//,//,//,//,//,//,//,//,//,//sw,//s6,32(sp)
0x27cb8a93,//,//,//,//,//,//,//,//,//,//,//addi,//s5,s7,636,//#,//8000027c,//<_end+0xffff727c>
0x27cb8b13,//,//,//,//,//,//,//,//,//,//,//addi,//s6,s7,636
0x02112e23,//,//,//,//,//,//,//,//,//,//,//sw,//ra,60(sp)
0x02812c23,//,//,//,//,//,//,//,//,//,//,//sw,//s0,56(sp)
0x03212823,//,//,//,//,//,//,//,//,//,//,//sw,//s2,48(sp)
0x03412423,//,//,//,//,//,//,//,//,//,//,//sw,//s4,40(sp)
0x01912a23,//,//,//,//,//,//,//,//,//,//,//sw,//s9,20(sp)
0x01a12823,//,//,//,//,//,//,//,//,//,//,//sw,//s10,16(sp)
0x01b12623,//,//,//,//,//,//,//,//,//,//,//sw,//s11,12(sp)
0x17cc0c13,//,//,//,//,//,//,//,//,//,//,//addi,//s8,s8,380,//#,//8000017c,//<_end+0xffff717c>
0x27cb8b93,//,//,//,//,//,//,//,//,//,//,//addi,//s7,s7,636
0x01000993,//,//,//,//,//,//,//,//,//,//,//li,//s3,16
0x28c48493,//,//,//,//,//,//,//,//,//,//,//addi,//s1,s1,652,//#,//8000028c,//<_end+0xffff728c>
0x000baa03,//,//,//,//,//,//,//,//,//,//,//lw,//s4,0(s7)
0xff098413,//,//,//,//,//,//,//,//,//,//,//addi,//s0,s3,-16
0x000c0913,//,//,//,//,//,//,//,//,//,//,//mv,//s2,s8
0x008a87b3,//,//,//,//,//,//,//,//,//,//,//add,//a5,s5,s0
0x0007ac83,//,//,//,//,//,//,//,//,//,//,//lw,//s9,0(a5)
0x019a5463,//,//,//,//,//,//,//,//,//,//,//bge,//s4,s9,800000a0,//<main+0x78>
0x000a0c93,//,//,//,//,//,//,//,//,//,//,//mv,//s9,s4
0x00090d93,//,//,//,//,//,//,//,//,//,//,//mv,//s11,s2
0x000b0d13,//,//,//,//,//,//,//,//,//,//,//mv,//s10,s6
0x000d2503,//,//,//,//,//,//,//,//,//,//,//lw,//a0,0(s10)
0x004d0d13,//,//,//,//,//,//,//,//,//,//,//addi,//s10,s10,4
0x00acd463,//,//,//,//,//,//,//,//,//,//,//bge,//s9,a0,800000b8,//<main+0x90>
0x000c8513,//,//,//,//,//,//,//,//,//,//,//mv,//a0,s9
0x000da703,//,//,//,//,//,//,//,//,//,//,//lw,//a4,0(s11)
0x004d8d93,//,//,//,//,//,//,//,//,//,//,//addi,//s11,s11,4
0x40e50533,//,//,//,//,//,//,//,//,//,//,//sub,//a0,a0,a4
0x00153513,//,//,//,//,//,//,//,//,//,//,//seqz,//a0,a0
0xf49ff0ef,//,//,//,//,//,//,//,//,//,//,//jal,//ra,80000010,//<check>
0xfda49ee3,//,//,//,//,//,//,//,//,//,//,//bne,//s1,s10,800000a8,//<main+0x80>
0x00100513,//,//,//,//,//,//,//,//,//,//,//li,//a0,1
0x00440413,//,//,//,//,//,//,//,//,//,//,//addi,//s0,s0,4
0xf39ff0ef,//,//,//,//,//,//,//,//,//,//,//jal,//ra,80000010,//<check>
0x01090913,//,//,//,//,//,//,//,//,//,//,//addi,//s2,s2,16
0xfb3418e3,//,//,//,//,//,//,//,//,//,//,//bne,//s0,s3,80000090,//<main+0x68>
0x00100513,//,//,//,//,//,//,//,//,//,//,//li,//a0,1
0xf29ff0ef,//,//,//,//,//,//,//,//,//,//,//jal,//ra,80000010,//<check>
0x01040993,//,//,//,//,//,//,//,//,//,//,//addi,//s3,s0,16
0x05000793,//,//,//,//,//,//,//,//,//,//,//li,//a5,80
0x004b8b93,//,//,//,//,//,//,//,//,//,//,//addi,//s7,s7,4
0x040c0c13,//,//,//,//,//,//,//,//,//,//,//addi,//s8,s8,64
0xff0a8a93,//,//,//,//,//,//,//,//,//,//,//addi,//s5,s5,-16
0xf8f992e3,//,//,//,//,//,//,//,//,//,//,//bne,//s3,a5,80000084,//<main+0x5c>
0x00100513,//,//,//,//,//,//,//,//,//,//,//li,//a0,1
0xf09ff0ef,//,//,//,//,//,//,//,//,//,//,//jal,//ra,80000010,//<check>
0x03c12083,//,//,//,//,//,//,//,//,//,//,//lw,//ra,60(sp)
0x03812403,//,//,//,//,//,//,//,//,//,//,//lw,//s0,56(sp)
0x03412483,//,//,//,//,//,//,//,//,//,//,//lw,//s1,52(sp)
0x03012903,//,//,//,//,//,//,//,//,//,//,//lw,//s2,48(sp)
0x02c12983,//,//,//,//,//,//,//,//,//,//,//lw,//s3,44(sp)
0x02812a03,//,//,//,//,//,//,//,//,//,//,//lw,//s4,40(sp)
0x02412a83,//,//,//,//,//,//,//,//,//,//,//lw,//s5,36(sp)
0x02012b03,//,//,//,//,//,//,//,//,//,//,//lw,//s6,32(sp)
0x01c12b83,//,//,//,//,//,//,//,//,//,//,//lw,//s7,28(sp)
0x01812c03,//,//,//,//,//,//,//,//,//,//,//lw,//s8,24(sp)
0x01412c83,//,//,//,//,//,//,//,//,//,//,//lw,//s9,20(sp)
0x01012d03,//,//,//,//,//,//,//,//,//,//,//lw,//s10,16(sp)
0x00c12d83,//,//,//,//,//,//,//,//,//,//,//lw,//s11,12(sp)
0x00000513,//,//,//,//,//,//,//,//,//,//,//li,//a0,0
0x04010113,//,//,//,//,//,//,//,//,//,//,//addi,//sp,sp,64
0x00008067,//,//,//,//,//,//,//,//,//,//,//ret

0x00050513,//,//,//,//,//,//,//,//,//,//,//mv,//a0,a0
0x0000006b,//,//,//,//,//,//,//,//,//,//,//0x6b
0x0000006f,//,//,//,//,//,//,//,//,//,//,//j,//80000154,//<halt+0x8>

0x80000537,//,//,//,//,//,//,//,//,//,//,//lui,//a0,0x80000
0xff010113,//,//,//,//,//,//,//,//,//,//,//addi,//sp,sp,-16
0x17850513,//,//,//,//,//,//,//,//,//,//,//addi,//a0,a0,376,//#,//80000178,//<_end+0xffff7178>
0x00112623,//,//,//,//,//,//,//,//,//,//,//sw,//ra,12(sp)
0xec1ff0ef,//,//,//,//,//,//,//,//,//,//,//jal,//ra,80000028,//<main>
0x00050513,//,//,//,//,//,//,//,//,//,//,//mv,//a0,a0
0x0000006b,//,//,//,//,//,//,//,//,//,//,//0x6b
0x0000006f,//,//,//,//,//,//,//,//,//,//,//j,//80000174,//<_trm_init+0x1c>  
  // test by me
  // 0x800002b7,  // lui t0,0x80000
  // 0x0002a023,  // sw  zero,0(t0)
  // 0x0002a503,  // lw  a0,0(t0)
  // 0x0000006b,  // nemu_trap
};

static void restart() {
  /* Set the initial program counter. */
  cpu.pc = RESET_VECTOR;

  /* The zero register is always 0. */
  cpu.gpr[0]._32 = 0;
}

void init_isa() {
  /* Load built-in image. */
  memcpy(guest_to_host(RESET_VECTOR), img, sizeof(img));

  /* Initialize this virtual computer system. */
  restart();
}
